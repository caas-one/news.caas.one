# 选择太多:如何选择正确的工具来管理Docker集群 （93）

![](https://images.unsplash.com/photo-1465844880937-7c02addc633b?ixlib=rb-1.2.1&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=1080&fit=max&ixid=eyJhcHBfaWQiOjExNzczfQ)

运行Docker有各种各样的方法，很明显，没有一种方法是适合于每个用例的。因此，我在这里要做的是给你一个关于每一个最明显的管理选项的简短的功能概述，在某种程度上可以帮助你选择自己的字体文件，并在这一过程中省去你大量的时间和麻烦。这样看起来就会很快速，并且没人会知道原来是我干的。

首先，这里每一篇关于任何主题的文章，甚至是与Docker有一点关联的文章都必须以这句话开头:在过去的n年中(其中n<6)，容器技术，特别是Docker已经成为应用程序提供领域的主要工具。

很好。抛开那个不说，我们可以谈正事了。所以你正在考虑通过Docker容器实施你的应用程序或网络服务…或者至少好好监测他们。我当然不会和你争论:那可能是个不错的选择。

现在想必你已经知道Docker引擎是一个开源软件环境，它允许你对主机硬件系统的各个部分进行虚拟化，直到它们的外观和实际运行与真正的服务器一样。Docker现在有免费的(社区版)商业支持的(企业版)版本。

毫无疑问，你也知道，从你的命令行调用Docker引擎使用于像这样的事情:

**$ docker ps$ docker images**

和

**$ docker network inspect**

…会把事情做好。对于那些感觉还是不太好?在Pluralsight网站上，和在我面向docker的课程中，有一些你可能会喜欢的介绍材料。

当你还在摸索的时候，所有的这些都很有用。但是，一旦你准备好开始规划一个稳定的、高度可伸缩的部署——完成复杂的配置，其中可能包括微服务和网络纽带——那么情况就会很快发生变化。问题不在于“如何”，而在于“在哪里和哪一个”:你有计算机和网络资源来运行你的应用程序本地？或者你需要找到一个主机?你应该自己做还是选择像AWS的Elastic Beasntalk那样在公共云上的托管服务?

那么管理呢?你是一个亲身实践型的人，还是喜欢站在后面一两层，让Kubernetes或Docker群集模式等管理工具帮你完成一些繁重的工作?或者再退两到三层，让Ansible或者Puppet来帮你完成这些?

让我们将内容分为三类:用于存储和管理Docker映像的存储库工具，用于定义、启动和管理Docker容器的管理框架，以及一些命令行和配置自动化管理工具。

## 1、图像注册表

### Docker Hub

对于大多数人来说，寻找Docker映像(包含用于运行容器的操作系统和软件包)的第一个地方是Docker本身提供的Docker Hub。Docker Hub包含大量预先加载的图像，以支持各种应用程序接口。你可以在hub.docker.com网站上查找和研究图像，然后将它们直接拖放到你自己的Docker引擎环境中。

**$ docker pull ubuntu**

一旦开始创建自己的图像,你就可以在Docker Hub上的公共存储库中安全地存储尽可能多的图像。此外，他们会让你免费得到一份私人回购，更多的回购价格大约是一美元一份。也许Docke rHub最好的地方在于它可以与几乎所有与Docker相连的东西无缝地工作，包括像AWS这样的公共云提供商和像Docker云这样的基础设施管理服务。

独立的Docker存储服务允许你发布预认证的图像和插件，以满足对可信资源的访问需求。

### EC2容器登记处(ECR)

亚马逊的AWS完全了解Docker的能力和潜力，并希望加入这个运行过程。作为向尽可能多的Docker业务开放云生态系统的努力的一部分，他们已经建立了自己的注册表，以配合他们的EC2容器服务平台:ECR。可以通过AWS GUl或CLI工具对图像进行推入、提取和管理。权限策略可以对你选择的人的图像访问进行严格控制。

有限制吗?显然，ECR的设计目的是使基础设施在基于AWS的服务(如ECS和Elastic Beanstalk)上运行时运行得最好。

### Docker注册表

如果出于安全或实用性原因，需要将图像保持在离首页更近一些，那么你需要了解Docker的免费Docker注册表。你可以指定一个注册服务器，它可以访问你的其他网络资产，安装然后启用docker注册包，标记图像，使它们指向你的本地注册表，这样你就得到了一个真正的、实时的私有repo。

**$ dpkg -i docker-registry_2.4.1~ds1-2_amd64.deb$ systemctl enable docker-registry$ docker tag hello-world localhost:5000/hello-world:latest**

图像本身存储在服务器上的文件系统中，但是可以通过与Docker Hub上相同的CLI工具来获得它们。担心你照片的安全?Docker Registry允许你应用SSL/TLS证书明，并通过强制对站点进行登录身份验证来控制访问。

Docker可信注册表是Docker注册表的商业版本。按每月或每年收费，通过缴费你可以使用额外的功能，包括维持、基于浏览器的GUI和LDAP/AD集成。

## 2、管理框架

即使你已经从只是查看如何运行的阶段进级，你可能仍然希望在本地保持运作的Docker部署:也许你的客户端都是本地的，或者你提供的工作负载并没有那么繁重。或许你只是对安全有些偏执。当然，我所说的“对安全的偏执”是指“对网络漏洞的当前状态了如指掌”。

“本地化”的一种方法就是继续你持续在做的事情。只要有资源安全性和容量方面的考虑，就没有理由放弃已经安装的旧的Community Edition Docker引擎。

然而，如果你认为将要面对的复杂程度让你感到有点迷失，那么你可能需要考虑是否升级到一个可以提供基于浏览器的管理控制台商业环境。无论如何，你都需要提供自己的托管环境，以便容器在其中运行。这可能是你的本地服务器，或者是在AWS或Azure等公共云中运行的虚拟机。

### Docker数据中心

通过在本地服务器上下载并安装常规Docker引擎，以及称为Docker Universal Control Plane (UCP)的第二个数据包，你可以设置数据中心(现在作为Docker企业版的一部分上市)。UCP提供了一个浏览器界面，并且允许对所有的图片和应用程序进行集中管理，以及构成你的基础设施。网络安全也是通过接口处理的。

### Docker Cloud

与Docker数据中心(也是官方的Docker产品)非常相似，Docker Cloud提供了一个基于GUI和浏览器的控制台，用于管理Docker部署的所有方面。这包括管理在公共云中运行的主机节点。与数据中心不同的是，Docker云管理服务是由Cloud .docker.com站点托管的:即在你自己的设备上不需要安装服务器软件。

![](https://cdn-media-1.freecodecamp.org/images/0*ab1QINvkjm9id1jY.png)
Docker Cloud——云提供商设置

它通过为你的云提供商帐户(如AWS)输入身份验证信息进行运作，或者在任何有网络连接的Linux或Windows机器上安装Docker云代理。在Node Clusters窗口中单击“带上你自己的节点”按钮，将会显示一个Linux命令来下载和安装代理，其大致如下所示:

**$ curl -Ls https://get.cloud.docker.com/ | sudo -H sh -s 90b501cb04e344bfbf76890a09362c39**

Docker云将资源整理到节点集群中，节点集群是作为单个服务的一部分进行管理的单个节点组，所有这些节点都致力于实现统一的部署目标。

我认为Docker继续推广这两种类似服务(数据中心和云)的部分原因可以追溯到几年前，Docker收购了一家名为Tutum的公司，并将其基于网页的产品重新命名为Docker Cloud。Tutum已经有了满意的客户群和相当成功的商业模式，所以没有理由停止它。无论如何，这两种方法都是有效的。所以我只是选一个能让你想起的。

### AWS EC2集装箱服务(ECS)

除了ECR映像注册表之外，AWS还为托管和管理Docker容器集群创建了自己的完整基础设施。ECS的工作方式是提供一个专门构建的EC2实例，同时安装Docker引擎和ECS代理。使用ECS控制台或AWS CLI，你可以定义、启动和管理EC2实例上的容器。

**$ aws ecs describe-clusters**

说实话，弄清楚所有ECS部件如何组合在一起是一项艰巨的任务。我在Pluralsight上的“在亚马逊网络服务上使用Docker”课程花了一些时间来解释这些部件是如何工作的。以下是简短版本:

* 任务:定义应用程序及其网络、存储和安全环境的元数据
* 服务:启动、监视和控制容器的软件
* 容器:将运行任务的机器的项目管理
* 集群:为任务和服务组织结构

![](https://cdn-media-1.freecodecamp.org/images/0*IaNAvWY8t6EU_oMA.jpg)
EC2容器服务体系结构的关系图

### AWS Elastic Beanstalk

Elastic Beanstalk有效地位于ECS之上，允许你跨ECS通常使用的所有AWS资源部署应用程序，但实质上所有的后勤工作都被抽离了。实际上，要启动一个完全可伸缩的复杂微服务环境，你所需要的只是一个名为dockerrun .aw.json的文件中的一个json格式的声明性脚本。你可以将脚本上传到GUl，或者使用AWS Beanstalk命令行接口从初始化的本地目录运行它，通过使用以下命令运行:

**$ eb run**

就是这样。也不全是这样。

我应该提一下那个Dockerrun.aws.json文件有两种格式:用于单个容器部署的V1和用于多个容器的V2。值得注意的是，与浏览器版本相比，使用CLl的一大优点是它可以使远程SSH登录到EC2主机使得管理任务变得更加容易。

这里还有一些其他的事情:我的“在一个月的午餐时间里学习亚马逊网络服务”一书的前17个章节，一步一步地追踪了一个高可用性、可扩展和安全的WordPress站点的构建。在第19章中，为了快速说明它是如何运作的，我创建了一个20行的Dockerrun.aws.ison文件，它只要五分钟就能完成几乎完全相同的事情。

这并不是说这本书的前17章是在浪费时间!事实上，如果不了解AWS的各个服务是如何运行的，你就不可能完全理解Beanstalk实际完成的工作。而且，你肯定会错过各种各样的功能，而这些功能可以让你用到更多Beanstalk所提供的功能。但它也确实说明了脚本部署的威力，不是吗?

## 3、管理工具

### Docker群集模型

虽然它现在已经是Docker引擎的一部分了，也许是因为它还在进行稳定的变化，但Docker群集模式在某种程度上还是有独立产品的味道。其思想是，你可以将其中一个服务器(称为节点)指定为管理器。

**$ docker swarm init**

...其他作为客户端的服务器:

**$ docker swarm join**

从这里开始，使用来自管理器的“docker服务”命令将创建和管理docker容器集群作为服务，并在所有可用的服务器之间自动有效地散布容器，不管它们可能位于何处。你应该亲自尝试一下，因为运行一个简单的“服务规模”命令并看到适当数量的容器立即出现在自己的网络中会让你激动不已。

**$ docker service create -p 80:80 --name webserver nginx$ docker service scale webserver=5**

我将自己的Pluralsight课程的一部分“使用Docker与AWS Elastic Beanstalk”用于实际演示Docker群集。如果你感兴趣，可以看看。

### Kubernetes

与Swarm一样，谷歌的Kubernetes也非常擅长高效地管理大型容器集群。说Kubernetes受欢迎，就像说一件众所周知的事一样。

Kubernetes将资源整理到pod中，pod本身是由运行各个微服务的相互连接的容器组成的。你应该将pod看作是完全可自由使用的，它的功能可以立即被等待进入这个界面的其他东西替代。

实际上，pod是根据调度程序和复制控制器等在主节点上定义的需求创建和销毁的，所有这些都可以由kubectl程序管理。当工作节点运行它们自己的Docker引擎时，pod和它们的容器在称为工作节点的服务器上运行。

我不知道你是怎么想的，但是我发现每个平台都选择用不同的名称来表示组成元素，这既令人困惑又令人恼火——但是通常只有略微不同的名称。所以针对这个应该有一条具体的规定。

**部署自动化工具**

我不能不提到如何使用Ansible、Jenkins和Puppet等流行的部署编制工具来自动化Docker环境。深入研究这些细节将使我远远超出本文的最初计划，因此只需选择你最喜欢的工具即可。

这有用吗?请查看我的Bootstrap IT网站上类似的Docker、Linux和AWS goodnesss文章。