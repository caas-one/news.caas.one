![](https://miro.medium.com/max/875/1*fHXSwrmd50BUgxa31tqSRQ.png)
# 命令式 VS 声明式

原文作者：Dominik Tornow
原文地址：[Imperative vs Declarative](https://medium.com/@dominik.tornow/imperative-vs-declarative-8abc7dcae82e)



作者：[Andrew Chen](https://medium.com/@chenopis) 和 [Dominik Tornow](https://medium.com/@dominik.tornow)


Kubernetes是一个容器编排引擎，这个容器编排引擎被设计用于在一组节点（通常称为集群）上承载容器化的应用程序。使用系统建模方法，本系列旨在促进读者对Kubernetes及其基础概念的理解。




Kubernetes通常被描述为一个声明式系统，并与命令式系统进行比较。然而，“声明式”和“命令式”这两个术语的含义并不明显。这篇博客提供了一个简洁的模型来说明两者的相似之处和不同之处。




## 计算模型
本文的其余部分将采用一个简单的**状态机计算模型**。在状态机模型中，计算被定义为使用将系统从一种状态**转换**到另一种状态的**命令**。
因此，正在运行的系统是一系列命令，它们通过各种状态转换系统。


![图1.状态机计算模型](https://miro.medium.com/max/1955/1*Y-MyttI0NeR3ubuk3c2HyA.png)


如果当前状态等于所需状态，则认为系统处于匹配状态。相反，如果当前状态不等于所需状态，则认为系统处于状态偏移。将系统从当前状态转换为给定所需状态的一组命令称为缓解措施。




例如，给定初始状态S，命令C将系统转换为状态S'。类似地，C'将系统转换为S''等等。当S为当前状态，S''为所需状态时，这组缓解措施就是{C，C'，C''}。

![图2.结构图指出了状态机计算模型中的角色](https://miro.medium.com/max/2678/1*9L3mWhJndXNUwj-8G8D7sg.png)


图2.结构图指出了参与在状态机计算模型中的角色。自动机负责把给定的命令应用到当前状态，该命令能够将系统转换到下一个状态。但是，系统所处的环境也会影响系统的状态。




在这里，**预期的状态更改**是显式提供的命令的结果所导致的任何状态更改。相反，**非预期的状态更改**是由于系统与环境交互从而导致的状态变化。



在kubernetes中，预期的状态更改可能是Pod或ReplicaSet的部署，而非预期的状态更改可能是单个容器或整个节点的关闭。


## 命令式系统

在**命令式系统**中，用户知道所需状态，确定将系统转换为所需状态的命令序列，并向系统提供命令的描述。应用命令来转换状态的系统组件称为处理器。

![图3.命令式系统](https://miro.medium.com/max/3878/1*TmGqScQkRz7Qn70j0AD7aQ.png)

## 声明式系统

相比之下，在**声明式系统**中，用户知道所需状态，还需向系统提供所需状态的描述，然后系统读取当前状态并确定将系统转换为所需状态的命令序列。决定必要命令序列的组件称为控制器。

![图4.声明式系统](https://miro.medium.com/max/3878/1*YZZY5GwXRnGZGo_UJ77mkA.png)

声明式系统具有明显的优势，能够在无需进一步监督的情况下对非预期的状态更改作出反应：如果非预期的状态更改导致状态偏移，系统可以自动确定并应用能够使得状态匹配的一组缓解措施。这个过程被称为**控制回路**，是控制器实现的一种普遍选择。


## Kubernetes

Kubernetes就是一个声明式系统。但是它不单单只有一个控制器，而是有几个控制器，每个控制器负责不同的kubernetes对象类型，例如ReplicaSet或Deployment。API服务器充当处理器，将控制器提供的命令应用于存储在kubernetes对象存储区中的系统状态。

![图5.Kubernetes是一个声明式系统](https://miro.medium.com/max/3878/1*OoPeNDU1WwsiP8OLhRgnAw.png)


## 总结

命令式和声明式系统的定义方面是谁坐在驾驶座这一问题的回答。用户或系统是否负责协调系统本身过渡到所需状态？



在命令式系统中，用户负责知道如何将系统驱动到所需状态，而在声明式系统中，系统负责知道如何将自己驱动到所需状态。



## 关于这篇文章

这篇博文是CNCF、Google和SAP为促进对Kubernetes及其基本概念的理解而进行的合作的一部分。








